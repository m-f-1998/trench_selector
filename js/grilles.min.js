/*global jQuery, console, document*/
/*global basketProducts, prevGrilleCost:true, selectedAdditions, basePrice, setPrice*/

var price;

function success(product, productString, totalGrillePrice, currentAdditionalCosts) {
    'use strict';
    var i;

    setPrice(
        ((currentAdditionalCosts - parseFloat(prevGrilleCost)) + parseFloat(totalGrillePrice)).toFixed(2),
        (((currentAdditionalCosts - parseFloat(prevGrilleCost)) + parseFloat(totalGrillePrice)) + basePrice).toFixed(2)
    );
    prevGrilleCost = totalGrillePrice;

    selectedAdditions[1] = product.options[product.selectedIndex].text;
    productString = productString.replaceAt(0, product.value);

    for (i = 0; i < basketProducts.length; i += 1) {
        basketProducts[i][1] = basketProducts[i][1].replaceAt(14, productString);
    }

}

/* GET GRILLE PRICE FOR PARTICULAR SPECIFICATION */
function grillePrice(grilleLength, grilleQuantity, grilleID, electricFlag, productString, product) {
    'use strict';
    price = 0;
    jQuery.ajax({

        type: "GET",
        url: //URL,
        data: "grilleLength=" + grilleLength + "&grilleID=" + grilleID + "&electricFlag=" + electricFlag,
        cache: true,
        success: function (result) {

            var currentAdditionalCosts;

            price = (parseFloat(price) + (parseFloat(result) * parseFloat(grilleQuantity))).toFixed(2);
            currentAdditionalCosts = parseFloat(
                document.getElementById("additionalCosts").innerHTML.substring(19, document.getElementById("additionalCosts").innerHTML.length)
            );
            success(product, productString, price, currentAdditionalCosts);

        },
        error: function (data) {
            /* eslint-disable no-console */
            console.error("GETTING GRILLE PRICES ERROR: " + data);
            /* eslint-disable no-console */
        }
    });

}

/* RETURN TOTAL PRICE FOR GRILLE FROM DATABASE */
function getTotalGrillePrice(product, productString) {
    'use strict';
    var totalGrillePrice, i;
    totalGrillePrice = 0.00;

    if (String(product.value) !== "noGrille") {
        for (i = 0; i < basketProducts.length; i += 1) {
            if (basketProducts[i][0] === "Electric") {

                if (basketProducts[i][9] === "") {

                    grillePrice(basketProducts[i][2], 0, String(product.value), 1, productString, product);

                } else {

                    grillePrice(basketProducts[i][2], basketProducts[i][9], String(product.value), 1, productString, product);

                }

            } else {

                if (basketProducts[i][9] === "") {

                    grillePrice(basketProducts[i][2], 0, String(product.value), 0, productString, product);

                } else {

                    grillePrice(basketProducts[i][2], basketProducts[i][9], String(product.value), 0, productString, product);

                }

            }
        }
    }

    totalGrillePrice = totalGrillePrice + parseFloat(price);
    return totalGrillePrice;

}

/* UPDATE GRILLE IN PRODUCT CODE */
function updateGrille(product) { // eslint-disable-line no-unused-vars
    'use strict';
    var productString, currentAdditionalCosts;

    productString = basketProducts[0][1].substring(14, 17);
    currentAdditionalCosts = parseFloat(
        document.getElementById("additionalCosts").innerHTML.substring(19, document.getElementById("additionalCosts").innerHTML.length)
    );

    if (product.value !== "-") {

        document.getElementById("loading").style.display = "block";
        getTotalGrillePrice(product, productString, currentAdditionalCosts);
        document.getElementById("loading").style.display = "none";

    } else {

        success(product, productString, "0", currentAdditionalCosts);

    }

}
