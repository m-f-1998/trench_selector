/*global document, Choices, jQuery*/
/*global prevGrilleCost:true, getAccessories, updateGrille*/
/*exported prevGrilleCost, selectedAdditions*/

var accessSelection, reRetrived, basketProducts, selectedAdditions, basePrice, troughPercentage, waterPercentage;
troughPercentage = 0;
waterPercentage = 0;
prevGrilleCost = 0;
selectedAdditions = ["Trough Material: Standard - Stainless Steel AlSl 304", "Grille: Al Natural", "Position of Water Connector: Right Connector"];
reRetrived = false;

/* REPLACE AT STRING INDEX */
String.prototype.replaceAt = function (index, replacement) {
    'use strict';
    
    return this.substr(0, index) + replacement + this.substr(index + replacement.length);
    
};

/* RETURN AMALGAMATED PERCENTAGE REDUCTION OF BASE PRICE */
function percentDifference(totalPercent) { // eslint-disable-line no-unused-vars
    'use strict';
    var percentage, minus;
    if ((parseFloat(troughPercentage) + parseFloat(waterPercentage)) === 0) {

        return basePrice;
        
    } else {

        percentage = (parseFloat(troughPercentage) + parseFloat(waterPercentage));
        minus = (basePrice / 100) * percentage;
        return (basePrice + minus);
        
    }
    
}

/* SET ADDITIONAL PRICE TEXT AND FINAL ESTIMATED PRICE TEXT */
function setPrice(additional, estimated) { // eslint-disable-line no-unused-vars
    'use strict';
    
    document.getElementById("additionalCosts").innerHTML = "Price for Grille: &#163;" + additional;
    document.getElementById("finalEstimatedPrice").innerHTML = "Estimated Price: &#163;" + parseFloat(estimated).toFixed(2);
    
}

/* UPDATE ACCESSORIES SELECTOR */
function updateAccessSelector() {
    'use strict';
    
    if (reRetrived) { //IF MODAL PREVIOUSLY SHOWN
        
        accessSelection.destroy();
        accessSelection.init();
        accessSelection.setValue([]);
        
    } else {
        
        getAccessories(); //RETRIEVE ACCESSORIES FROM DATABASE
        jQuery('#access').one("DOMSubtreeModified", function () {
            accessSelection = new Choices(document.getElementById('access'), {});
            reRetrived = true;
        });
    }
    
}

/* UPDATE DETAILS OF SELECTED PRODUCTS ON MODAL */
function initialUpdateModal(savedProducts) {  // eslint-disable-line no-unused-vars
    'use strict';
    var currentAdditionalCosts, x;
    
    basketProducts = savedProducts;
    updateAccessSelector();
    
    /* CALCULATE BASE PRICE */
    basePrice = 0;
    for (x = 0; x < basketProducts.length; x += 1) {
        if (basketProducts[x][9] !== "") {
            basePrice = basePrice + (parseFloat(basketProducts[x][7]) * parseFloat(basketProducts[x][9]));
        }
    }
    
    /* RESET INDEXES OF CUSTOMISATIONS */
    document.getElementsByName("water")[0].selectedIndex = 0;
    document.getElementsByName("grille")[0].selectedIndex = 0;
    document.getElementsByName("troughMaterial")[0].selectedIndex = 0;
    
    updateGrille(document.getElementById("grille")); //RESET GRILLE VALUE

    /* CALCULATE AND SET BASE AND ADDITIONAL PRICES */
    document.getElementById("finalBasePrice").innerHTML = "Base Price: &#163;" + String(basePrice.toFixed(2));
    
    /* SET FINAL ESTIMATED PRICE */
    currentAdditionalCosts = parseFloat(
        document.getElementById("additionalCosts").innerHTML.substring(19, document.getElementById("additionalCosts").innerHTML.length)
    );
    document.getElementById("finalEstimatedPrice").innerHTML = "Estimated Price: &#163;" + (parseFloat(currentAdditionalCosts) + parseFloat(basePrice)).toFixed(2);
            
}